<project_specification>
  <project_name>Starter-Kit</project_name>

  <overview>
    Boilerplate éducatif minimaliste pour apprendre à créer un SaaS. L'application affiche une landing page 
    avec un tableau de statut indiquant visuellement si les credentials des différents services sont correctement 
    configurés (PostgreSQL, BetterAuth, Polar, OpenRouter). Une fois authentifié via Google, l'utilisateur 
    accède à une page profil avec un chatbot simple. Conçu pour enseigner les fondamentaux d'une stack SaaS moderne.
  </overview>

  <technology_stack>
    <frontend>
      <framework>Next.js 14+ with React 18+</framework>
      <styling>Tailwind CSS</styling>
      <state_management>React hooks</state_management>
      <port>3000</port>
    </frontend>
    <backend>
      <runtime>Next.js API Routes</runtime>
      <database>PostgreSQL with Drizzle ORM</database>
      <auth>BetterAuth with Google OAuth</auth>
      <payments>Polar (via BetterAuth integration)</payments>
      <llm>OpenRouter API</llm>
    </backend>
    <infrastructure>
      <containerization>Docker + docker-compose.yml</containerization>
      <configuration>.env file for all credentials</configuration>
    </infrastructure>
  </technology_stack>

  <prerequisites>
    <environment_setup>
      - Docker and Docker Compose installed
      - Node.js 18+ for local development
      - Google Cloud Console project for OAuth credentials
      - Polar account for payment integration
      - OpenRouter API key for LLM access
    </environment_setup>
    <env_variables>
      # Database
      DATABASE_URL=postgresql://user:password@localhost:5432/starterkit

      # BetterAuth
      BETTER_AUTH_SECRET=your-secret-key
      GOOGLE_CLIENT_ID=your-google-client-id
      GOOGLE_CLIENT_SECRET=your-google-client-secret

      # Polar
      POLAR_ACCESS_TOKEN=your-polar-access-token

      # OpenRouter
      OPENROUTER_API_KEY=your-openrouter-api-key
    </env_variables>
  </prerequisites>

  <security_and_access_control>
    <complexity_tier>Simple</complexity_tier>
    <test_count_target>50+</test_count_target>
    <user_roles>
      <role name="anonymous">
        <permissions>
          - Can view landing page
          - Can see credentials status table
          - Cannot access profile page
          - Cannot use chatbot
        </permissions>
      </role>
      <role name="authenticated">
        <permissions>
          - All anonymous permissions
          - Can access profile page
          - Can use chatbot (if OpenRouter configured)
        </permissions>
        <protected_routes>
          - /profile (authenticated users only)
        </protected_routes>
      </role>
    </user_roles>
    <authentication>
      <method>Google OAuth via BetterAuth</method>
      <session_timeout>7 days</session_timeout>
    </authentication>
  </security_and_access_control>

  <core_features>
    <landing_page>
      - Clean, minimal landing page
      - Centered credentials status table
      - Header with project name and login button
      - Login button disabled state when BetterAuth not configured
      - Visual feedback for each service status (green checkmark / red X)
    </landing_page>

    <credentials_status_table>
      - PostgreSQL connection status row
      - BetterAuth (Google OAuth) configuration status row
      - Polar integration status row
      - OpenRouter API configuration status row
      - Real-time status check on page load
      - Clear visual indicators (✅ connected, ❌ not configured)
    </credentials_status_table>

    <authentication>
      - Google OAuth login via BetterAuth
      - Login button in header (top-right)
      - Button disabled/grayed when credentials missing
      - Tooltip explaining why login is disabled
      - Automatic redirect to profile after login
      - Logout functionality
    </authentication>

    <profile_page>
      - Protected route (requires authentication)
      - Minimal/empty page layout
      - User info display (name, email, avatar from Google)
      - Logout button
      - Chatbot component at bottom
    </profile_page>

    <chatbot>
      - Simple prompt input field
      - Single response display (no history)
      - Disabled state when OpenRouter not configured
      - Loading indicator during API call
      - Error handling for API failures
      - Clear/reset button
    </chatbot>

    <status_checking_api>
      - Endpoint to check PostgreSQL connectivity
      - Endpoint to check BetterAuth configuration
      - Endpoint to check Polar configuration
      - Endpoint to check OpenRouter configuration
      - Combined status endpoint for all services
    </status_checking_api>
  </core_features>

  <database_schema>
    <tables>
      <users>
        - id (uuid, primary key)
        - email (varchar, unique, not null)
        - name (varchar)
        - avatar_url (varchar)
        - created_at (timestamp, default now)
        - updated_at (timestamp)
      </users>

      <sessions>
        - id (uuid, primary key)
        - user_id (uuid, foreign key -> users.id)
        - token (varchar, unique, not null)
        - expires_at (timestamp, not null)
        - created_at (timestamp, default now)
      </sessions>

      <accounts>
        - id (uuid, primary key)
        - user_id (uuid, foreign key -> users.id)
        - provider (varchar, not null) -- 'google'
        - provider_account_id (varchar, not null)
        - access_token (text)
        - refresh_token (text)
        - expires_at (timestamp)
        - created_at (timestamp, default now)
      </accounts>
    </tables>
  </database_schema>

  <api_endpoints_summary>
    <status>
      - GET /api/status - Get all services status
      - GET /api/status/database - Check PostgreSQL connection
      - GET /api/status/auth - Check BetterAuth configuration
      - GET /api/status/polar - Check Polar configuration
      - GET /api/status/openrouter - Check OpenRouter configuration
    </status>

    <auth>
      - GET /api/auth/session - Get current session
      - POST /api/auth/signin/google - Initiate Google OAuth
      - GET /api/auth/callback/google - Google OAuth callback
      - POST /api/auth/signout - Sign out user
    </auth>

    <chat>
      - POST /api/chat - Send prompt to OpenRouter, get response
    </chat>
  </api_endpoints_summary>

  <ui_layout>
    <main_structure>
      - Single column layout, centered content
      - Max-width container (max-w-2xl)
      - Responsive padding
    </main_structure>

    <landing_page_layout>
      <header>
        - Project name/logo on left
        - Login button on right
        - Sticky header with subtle shadow
      </header>
      <main>
        - Centered vertically and horizontally
        - Title: "Starter-Kit"
        - Subtitle: "Vérifiez la configuration de vos services"
        - Status table below
      </main>
      <status_table>
        - 2 columns: Service name | Status
        - 4 rows: PostgreSQL, BetterAuth, Polar, OpenRouter
        - Rounded corners, subtle border
        - Alternating row colors (subtle)
      </status_table>
    </landing_page_layout>

    <profile_page_layout>
      <header>
        - Same as landing page
        - Login button replaced with user avatar + logout
      </header>
      <main>
        - User greeting with name
        - Simple card with user info
        - Chatbot section below
      </main>
      <chatbot_section>
        - Card container
        - Title: "Assistant IA"
        - Disabled overlay if OpenRouter not configured
        - Input field with send button
        - Response area below input
      </chatbot_section>
    </profile_page_layout>
  </ui_layout>

  <design_system>
    <color_palette>
      - Background: White (#FFFFFF) / Dark (#0A0A0A for dark mode)
      - Surface: Light gray (#F5F5F5) / Dark gray (#171717)
      - Primary: Blue (#3B82F6)
      - Success: Green (#22C55E) - for connected status
      - Error: Red (#EF4444) - for disconnected status
      - Text: Near black (#171717) / Off-white (#EDEDED)
      - Muted: Gray (#6B7280)
      - Border: Light gray (#E5E7EB) / Dark (#262626)
    </color_palette>

    <typography>
      - Font: Inter (system font fallback)
      - Headings: font-semibold
      - Body: font-normal
      - Code: font-mono (for any code display)
    </typography>

    <components>
      <status_badge>
        - Rounded pill shape
        - Green background + checkmark for connected
        - Red background + X icon for disconnected
        - Icon + text label
      </status_badge>

      <button>
        - Primary: Blue background, white text, rounded-lg
        - Disabled: Gray background, reduced opacity, cursor-not-allowed
        - Hover: Slightly darker background
      </button>

      <card>
        - White background (dark: #171717)
        - Subtle border
        - Rounded-xl corners
        - Shadow-sm
        - Padding: p-6
      </card>

      <input>
        - Full width
        - Border with focus ring
        - Rounded-lg
        - Padding: px-4 py-2
      </input>
    </components>
  </design_system>

  <implementation_steps>
    <step number="1">
      <title>Project Setup & Infrastructure</title>
      <tasks>
        - Initialize Next.js project with TypeScript
        - Configure Tailwind CSS
        - Set up docker-compose.yml with PostgreSQL
        - Create .env.example with all required variables
        - Configure Drizzle ORM with PostgreSQL
        - Create database schema and migrations
      </tasks>
    </step>

    <step number="2">
      <title>Status Checking System</title>
      <tasks>
        - Create status check utility functions
        - Implement /api/status endpoints
        - Build PostgreSQL connection test
        - Build environment variable validation for each service
        - Create combined status endpoint
      </tasks>
    </step>

    <step number="3">
      <title>Landing Page & Status Table</title>
      <tasks>
        - Create landing page layout
        - Build header component with login button
        - Implement status table component
        - Add status badges with icons
        - Fetch and display real-time status
        - Style with Tailwind CSS
      </tasks>
    </step>

    <step number="4">
      <title>Authentication with BetterAuth</title>
      <tasks>
        - Install and configure BetterAuth
        - Set up Google OAuth provider
        - Create auth API routes
        - Implement login button logic (disabled state)
        - Add session management
        - Create protected route middleware
      </tasks>
    </step>

    <step number="5">
      <title>Profile Page</title>
      <tasks>
        - Create protected profile page
        - Display user information from session
        - Add logout functionality
        - Implement redirect for unauthenticated users
      </tasks>
    </step>

    <step number="6">
      <title>Chatbot Integration</title>
      <tasks>
        - Create chat API endpoint
        - Integrate OpenRouter API
        - Build chatbot UI component
        - Implement disabled state when not configured
        - Add loading and error states
        - Style chat input and response area
      </tasks>
    </step>

    <step number="7">
      <title>Polish & Documentation</title>
      <tasks>
        - Add dark mode support
        - Improve responsive design
        - Add tooltips for disabled states
        - Create README with setup instructions
        - Document all environment variables
        - Test full flow end-to-end
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      - All status checks work correctly
      - Google OAuth login functions properly
      - Profile page is protected and accessible after login
      - Chatbot sends prompts and displays responses
      - Disabled states work when credentials missing
    </functionality>

    <user_experience>
      - Clear visual feedback for all service statuses
      - Intuitive login flow
      - Helpful disabled state explanations
      - Fast page loads
      - Responsive on mobile devices
    </user_experience>

    <educational_value>
      - Clean, readable code structure
      - Well-documented configuration
      - Easy to understand architecture
      - Clear separation of concerns
      - Serves as learning template for SaaS development
    </educational_value>

    <technical_quality>
      - Docker setup works out of the box
      - Environment variables properly validated
      - Error handling throughout
      - TypeScript types for safety
      - Follows Next.js best practices
    </technical_quality>
  </success_criteria>
</project_specification>
